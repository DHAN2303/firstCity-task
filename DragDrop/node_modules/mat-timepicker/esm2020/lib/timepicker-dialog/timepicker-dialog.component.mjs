import { MAT_DIALOG_DATA } from '@angular/material/dialog';
import { Component, EventEmitter, Output, Inject } from '@angular/core';
import { twoDigits, convertHoursForMode } from '../util';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@angular/material/dialog";
import * as i3 from "@angular/material/button";
import * as i4 from "@angular/material/toolbar";
import * as i5 from "../clock/clock.component";
export class MatTimepickerComponentDialogComponent {
    constructor(data) {
        this.data = data;
        this.twoDigits = twoDigits;
        this.changeEvent = new EventEmitter();
        this.okClickEvent = new EventEmitter();
        this.cancelClickEvent = new EventEmitter();
        this.allowed24HourMap = null;
        this.allowed12HourMap = null;
        this.invalidSelection = false;
        this.viewType = 'hours';
        this.isPm = false;
        this.skipMinuteAutoSwitch = false;
        this.autoSwitchID = null;
        this.invalidMedianID = null;
        this.hasInvalidMeridiem = false;
        this.editHoursClicked = false;
        this.isClosing = false;
        this.okClickHandler = () => {
            if (this.hasInvalidMeridiem) {
                this.isPm = !this.isPm;
                this.hasInvalidMeridiem = false;
            }
            this.okClickEvent.emit(this.value);
        };
        this.cancelClickHandler = () => {
            this.cancelClickEvent.emit();
        };
        this.isPm = data.isPm;
        this.bindData(data);
        // keep this always at the bottom
        this.value = data.value;
    }
    set value(value) {
        value = value || this.minDate || this.maxDate || new Date();
        this.hours = value.getHours();
        this.minutes = value.getMinutes();
        this._value = value;
    }
    get value() { return this._value; }
    set hours(value) {
        this._hours = value;
        this._formattedHour = convertHoursForMode(this.hours, this.mode).hour;
    }
    get hours() { return this._hours; }
    get formattedHours() { return this._formattedHour; }
    bindData(data) {
        this.mode = data.mode;
        this.okLabel = data.okLabel;
        this.cancelLabel = data.cancelLabel;
        this.okButtonTemplate = data.okButtonTemplate;
        this.cancelButtonTemplate = data.cancelButtonTemplate;
        this.anteMeridiemAbbreviation = data.anteMeridiemAbbreviation;
        this.postMeridiemAbbreviation = data.postMeridiemAbbreviation;
        this.color = data.color;
        this.minDate = data.minDate;
        this.maxDate = data.maxDate;
        this.allowed12HourMap = data.allowed12HourMap;
        this.allowed24HourMap = data.allowed24HourMap;
    }
    ngDoCheck() { this.bindData(this.data); }
    handleClockChange({ value, type }) {
        const is24hoursAutoMeridiemChange = this.mode === '24h' && type === 'hours' && ((this.hours >= 12 && value < 12) || (this.hours < 12 && value >= 12));
        if ((this.hasInvalidMeridiem && this.mode === '12h') || is24hoursAutoMeridiemChange) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        if ((type && type === 'hours') || (!type && this.viewType === 'hours')) {
            this.hours = value;
        }
        else if ((type && type === 'minutes') || (!type && this.viewType === 'minutes')) {
            this.minutes = value;
        }
        const newValue = new Date();
        const hours = this.isPm ? this.hours < 12 ? this.hours + 12 : this.hours : this.hours === 12 ? 0 : this.hours;
        newValue.setHours(hours);
        newValue.setMinutes(this.minutes);
        newValue.setSeconds(0);
        newValue.setMilliseconds(0);
        this.value = newValue;
        this.changeEvent.emit(newValue);
    }
    clearInvalidMeridiem() {
        this.hasInvalidMeridiem = false;
    }
    handleUnavailableSelection() {
        clearTimeout(this.autoSwitchID);
    }
    handleClockChangeDone(e) {
        e.preventDefault(); // prevent mouseUp after touchEnd
        if (this.viewType === 'hours' && !this.skipMinuteAutoSwitch) {
            this.autoSwitchID = setTimeout(() => {
                this.editMinutes();
                this.autoSwitchID = null;
            }, 300);
        }
    }
    editHours() {
        this.viewType = 'hours';
        this.editHoursClicked = true;
        setTimeout(() => { this.editHoursClicked = false; }, 0);
    }
    editMinutes() {
        if (this.hasInvalidMeridiem) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        this.viewType = 'minutes';
    }
    invalidSelectionHandler(value) {
        this.invalidSelection = value;
    }
    invalidMeridiem() {
        if (this.viewType !== 'minutes' && this.editHoursClicked) {
            if (this.invalidMedianID) {
                return;
            }
            this.invalidMedianID = setTimeout(() => {
                this.isPm = !this.isPm;
                this.hasInvalidMeridiem = false;
            }, 0);
            return;
        }
        this.hasInvalidMeridiem = true;
    }
    meridiemChange(hours) {
        const changeData = {
            type: this.viewType,
            value: this.viewType === 'hours' ? hours : this.value.getMinutes()
        };
        this.handleClockChange(changeData);
    }
    setAm() {
        if (this.hours >= 12) {
            this.hours = this.hours - 12;
        }
        this.isPm = false;
        this.meridiemChange(this.hours);
    }
    setPm() {
        if (this.hours < 12) {
            this.hours = this.hours + 12;
        }
        this.isPm = true;
        this.meridiemChange(this.hours);
    }
}
MatTimepickerComponentDialogComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.1.1", ngImport: i0, type: MatTimepickerComponentDialogComponent, deps: [{ token: MAT_DIALOG_DATA }], target: i0.ɵɵFactoryTarget.Component });
MatTimepickerComponentDialogComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.1.1", type: MatTimepickerComponentDialogComponent, selector: "mat-timepicker-dialog", outputs: { changeEvent: "changeEvent", okClickEvent: "okClickEvent", cancelClickEvent: "cancelClickEvent" }, ngImport: i0, template: "<ng-template #defaultCancelButtonTemplate>\n  <button mat-button [color]=\"color\" (click)=\"cancelClickHandler()\">{{cancelLabel}}</button>\n</ng-template>\n<ng-template #defaultOkButtonTemplate>\n  <button mat-button [disabled]=\"invalidSelection\" [color]=\"color\" (click)=\"okClickHandler()\">{{okLabel}}</button>\n</ng-template>\n\n<mat-dialog-content>\n  <div class=\"root\">\n    <mat-toolbar [color]=\"color\" class=\"header\">\n      <div class=\"placeholder\"></div>\n      <div class=\"time-frame\">\n        <span class=\"time fixed-font-size\" [ngClass]=\"{'select': this.viewType === 'hours' && 'active' }\"\n          (click)=\"editHours()\">\n          {{ twoDigits(formattedHours) }}\n        </span>\n        <span class=\"fixed-font-size\">:</span>\n        <span class=\"time fixed-font-size\" [ngClass]=\"{ 'select': this.viewType === 'minutes' && 'active' }\"\n          (click)=\"editMinutes()\">\n          {{ twoDigits(minutes) }}\n        </span>\n      </div>\n      <ng-container *ngIf=\"mode === '12h' then ampm else normal\"></ng-container>\n      <ng-template #normal>\n        <div class=\"placeholder\"></div>\n      </ng-template>\n      <ng-template #ampm>\n        <div class=\"ampm\">\n          <span class=\"time\" [ngClass]=\"{ 'select': isPm }\" (click)=\"setPm()\">{{postMeridiemAbbreviation | uppercase\n            }}</span>\n          <span class=\"time\" [ngClass]=\"{ 'select': !isPm }\" (click)=\"setAm()\">{{anteMeridiemAbbreviation | uppercase\n            }}</span>\n        </div>\n      </ng-template>\n    </mat-toolbar>\n    <div class=\"body\">\n      <mat-clock [allowed12HourMap]=\"allowed12HourMap\" [allowed24HourMap]=\"allowed24HourMap\" [minDate]=\"minDate\"\n        [maxDate]=\"maxDate\" [color]=\"color\" [viewType]=\"viewType\" [mode]=\"mode\" [formattedHours]=\"formattedHours\"\n        [minutes]=\"minutes\" (changeEvent)=\"handleClockChange($event)\"\n        (unavailableSelection)=\"handleUnavailableSelection()\"\n        [formattedValue]=\"viewType === 'minutes' ? minutes : formattedHours\" [isPm]=\"isPm\"\n        (invalidMeridiem)=\"invalidMeridiem()\" (mouseup)=\"handleClockChangeDone($event)\"\n        (clearInvalidMeridiem)=\"clearInvalidMeridiem()\" (touchend)=\"handleClockChangeDone($event)\"\n        (invalidSelection)=\"invalidSelectionHandler($event)\"></mat-clock>\n    </div>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <ng-container\n    *ngTemplateOutlet=\"cancelButtonTemplate || defaultCancelButtonTemplate; context: { label: cancelLabel, $implicit: cancelClickHandler }\">\n  </ng-container>\n  <ng-container\n    *ngTemplateOutlet=\"okButtonTemplate || defaultOkButtonTemplate; context: { label: okLabel, $implicit: okClickHandler }\">\n  </ng-container>\n</mat-dialog-actions>", styles: ["mat-dialog-content{min-height:395px;padding:0;margin-top:-24px;overflow:hidden}mat-dialog-actions{justify-content:flex-end;margin-right:-8px;margin-left:-8px}.root{min-width:282px}.header{border-top-left-radius:2px;border-top-right-radius:2px;padding:20px 0;line-height:58px;font-size:58px;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;height:98px}.header .fixed-font-size{font-size:58px}.header .time-frame{height:60px}.time{transition:all .2s ease-out;cursor:pointer}.time:not(.select){opacity:.6}.placeholder{flex:1}.ampm{display:flex;flex-direction:column-reverse;flex:1;font-size:14px;line-height:20px;margin-left:16px;font-weight:700px}.select{color:#fff}.body{padding:24px 16px 20px;display:flex;justify-content:center}\n"], dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i2.MatDialogContent, selector: "[mat-dialog-content], mat-dialog-content, [matDialogContent]" }, { kind: "directive", type: i2.MatDialogActions, selector: "[mat-dialog-actions], mat-dialog-actions, [matDialogActions]", inputs: ["align"] }, { kind: "component", type: i3.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "component", type: i4.MatToolbar, selector: "mat-toolbar", inputs: ["color"], exportAs: ["matToolbar"] }, { kind: "component", type: i5.ClockComponent, selector: "mat-clock", inputs: ["mode", "viewType", "color", "formattedValue", "minDate", "maxDate", "isPm", "formattedHours", "minutes", "allowed12HourMap", "allowed24HourMap"], outputs: ["changeEvent", "unavailableSelection", "invalidMeridiem", "invalidSelection", "clearInvalidMeridiem"] }, { kind: "pipe", type: i1.UpperCasePipe, name: "uppercase" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.1.1", ngImport: i0, type: MatTimepickerComponentDialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'mat-timepicker-dialog', template: "<ng-template #defaultCancelButtonTemplate>\n  <button mat-button [color]=\"color\" (click)=\"cancelClickHandler()\">{{cancelLabel}}</button>\n</ng-template>\n<ng-template #defaultOkButtonTemplate>\n  <button mat-button [disabled]=\"invalidSelection\" [color]=\"color\" (click)=\"okClickHandler()\">{{okLabel}}</button>\n</ng-template>\n\n<mat-dialog-content>\n  <div class=\"root\">\n    <mat-toolbar [color]=\"color\" class=\"header\">\n      <div class=\"placeholder\"></div>\n      <div class=\"time-frame\">\n        <span class=\"time fixed-font-size\" [ngClass]=\"{'select': this.viewType === 'hours' && 'active' }\"\n          (click)=\"editHours()\">\n          {{ twoDigits(formattedHours) }}\n        </span>\n        <span class=\"fixed-font-size\">:</span>\n        <span class=\"time fixed-font-size\" [ngClass]=\"{ 'select': this.viewType === 'minutes' && 'active' }\"\n          (click)=\"editMinutes()\">\n          {{ twoDigits(minutes) }}\n        </span>\n      </div>\n      <ng-container *ngIf=\"mode === '12h' then ampm else normal\"></ng-container>\n      <ng-template #normal>\n        <div class=\"placeholder\"></div>\n      </ng-template>\n      <ng-template #ampm>\n        <div class=\"ampm\">\n          <span class=\"time\" [ngClass]=\"{ 'select': isPm }\" (click)=\"setPm()\">{{postMeridiemAbbreviation | uppercase\n            }}</span>\n          <span class=\"time\" [ngClass]=\"{ 'select': !isPm }\" (click)=\"setAm()\">{{anteMeridiemAbbreviation | uppercase\n            }}</span>\n        </div>\n      </ng-template>\n    </mat-toolbar>\n    <div class=\"body\">\n      <mat-clock [allowed12HourMap]=\"allowed12HourMap\" [allowed24HourMap]=\"allowed24HourMap\" [minDate]=\"minDate\"\n        [maxDate]=\"maxDate\" [color]=\"color\" [viewType]=\"viewType\" [mode]=\"mode\" [formattedHours]=\"formattedHours\"\n        [minutes]=\"minutes\" (changeEvent)=\"handleClockChange($event)\"\n        (unavailableSelection)=\"handleUnavailableSelection()\"\n        [formattedValue]=\"viewType === 'minutes' ? minutes : formattedHours\" [isPm]=\"isPm\"\n        (invalidMeridiem)=\"invalidMeridiem()\" (mouseup)=\"handleClockChangeDone($event)\"\n        (clearInvalidMeridiem)=\"clearInvalidMeridiem()\" (touchend)=\"handleClockChangeDone($event)\"\n        (invalidSelection)=\"invalidSelectionHandler($event)\"></mat-clock>\n    </div>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <ng-container\n    *ngTemplateOutlet=\"cancelButtonTemplate || defaultCancelButtonTemplate; context: { label: cancelLabel, $implicit: cancelClickHandler }\">\n  </ng-container>\n  <ng-container\n    *ngTemplateOutlet=\"okButtonTemplate || defaultOkButtonTemplate; context: { label: okLabel, $implicit: okClickHandler }\">\n  </ng-container>\n</mat-dialog-actions>", styles: ["mat-dialog-content{min-height:395px;padding:0;margin-top:-24px;overflow:hidden}mat-dialog-actions{justify-content:flex-end;margin-right:-8px;margin-left:-8px}.root{min-width:282px}.header{border-top-left-radius:2px;border-top-right-radius:2px;padding:20px 0;line-height:58px;font-size:58px;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;height:98px}.header .fixed-font-size{font-size:58px}.header .time-frame{height:60px}.time{transition:all .2s ease-out;cursor:pointer}.time:not(.select){opacity:.6}.placeholder{flex:1}.ampm{display:flex;flex-direction:column-reverse;flex:1;font-size:14px;line-height:20px;margin-left:16px;font-weight:700px}.select{color:#fff}.body{padding:24px 16px 20px;display:flex;justify-content:center}\n"] }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [MAT_DIALOG_DATA]
                }] }]; }, propDecorators: { changeEvent: [{
                type: Output
            }], okClickEvent: [{
                type: Output
            }], cancelClickEvent: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXBpY2tlci1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWF0LXRpbWVwaWNrZXIvc3JjL2xpYi90aW1lcGlja2VyLWRpYWxvZy90aW1lcGlja2VyLWRpYWxvZy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tYXQtdGltZXBpY2tlci9zcmMvbGliL3RpbWVwaWNrZXItZGlhbG9nL3RpbWVwaWNrZXItZGlhbG9nLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUF3QixNQUFNLGVBQWUsQ0FBQztBQUU5RixPQUFPLEVBQUUsU0FBUyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sU0FBUyxDQUFDOzs7Ozs7O0FBUXpELE1BQU0sT0FBTyxxQ0FBcUM7SUE2RWhELFlBQTRDLElBQUk7UUFBSixTQUFJLEdBQUosSUFBSSxDQUFBO1FBM0VoRCxjQUFTLEdBQUcsU0FBUyxDQUFDO1FBRVosZ0JBQVcsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN6RCxpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBUSxDQUFDO1FBQzNELHFCQUFnQixHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXhFLHFCQUFnQixHQUFzQixJQUFJLENBQUM7UUFDM0MscUJBQWdCLEdBQXNCLElBQUksQ0FBQztRQUUzQyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFxQnpCLGFBQVEsR0FBa0IsT0FBTyxDQUFDO1FBSWxDLFNBQUksR0FBRyxLQUFLLENBQUM7UUFDYix5QkFBb0IsR0FBRyxLQUFLLENBQUM7UUFDN0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsb0JBQWUsR0FBRyxJQUFJLENB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bkUsQ0FBQztRQUNGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBR0QsS0FBSztRQUNILElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLEVBQUU7WUFDcEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztTQUM5QjtRQUNELElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBRWxCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFFRCxLQUFLO1FBQ0gsSUFBSSxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsRUFBRTtZQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1NBQzlCO1FBQ0QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbEMsQ0FBQzs7a0lBeExVLHFDQUFxQyxrQkE2RTVCLGVBQWU7c0hBN0V4QixxQ0FBcUMsMEtDWGxELHd1RkFzRHFCOzJGRDNDUixxQ0FBcUM7a0JBTGpELFNBQVM7K0JBQ0UsdUJBQXVCOzswQkFpRnBCLE1BQU07MkJBQUMsZUFBZTs0Q0F6RXpCLFdBQVc7c0JBQXBCLE1BQU07Z0JBQ0csWUFBWTtzQkFBckIsTUFBTTtnQkFDRyxnQkFBZ0I7c0JBQXpCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNQVRfRElBTE9HX0RBVEEgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgSW5qZWN0LCBEb0NoZWNrLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2xvY2tWaWV3VHlwZSwgQ2xvY2tNb2RlLCBJQWxsb3dlZDI0SG91ck1hcCwgSUFsbG93ZWQxMkhvdXJNYXAgfSBmcm9tICcuLi9pbnRlcmZhY2VzLWFuZC10eXBlcyc7XG5pbXBvcnQgeyB0d29EaWdpdHMsIGNvbnZlcnRIb3Vyc0Zvck1vZGUgfSBmcm9tICcuLi91dGlsJztcbmltcG9ydCB7IE1hdFRpbWVwaWNrZXJCdXR0b25UZW1wbGF0ZUNvbnRleHQgfSBmcm9tICcuLi90aW1lcGlja2VyLmRpcmVjdGl2ZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21hdC10aW1lcGlja2VyLWRpYWxvZycsXG4gIHRlbXBsYXRlVXJsOiAnLi90aW1lcGlja2VyLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RpbWVwaWNrZXItZGlhbG9nLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTWF0VGltZXBpY2tlckNvbXBvbmVudERpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIERvQ2hlY2sge1xuXG4gIHR3b0RpZ2l0cyA9IHR3b0RpZ2l0cztcblxuICBAT3V0cHV0KCkgY2hhbmdlRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBva0NsaWNrRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxEYXRlPigpO1xuICBAT3V0cHV0KCkgY2FuY2VsQ2xpY2tFdmVudDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBhbGxvd2VkMjRIb3VyTWFwOiBJQWxsb3dlZDI0SG91ck1hcCA9IG51bGw7XG4gIGFsbG93ZWQxMkhvdXJNYXA6IElBbGxvd2VkMTJIb3VyTWFwID0gbnVsbDtcblxuICBpbnZhbGlkU2VsZWN0aW9uID0gZmFsc2U7XG5cbiAgb2tMYWJlbDogc3RyaW5nO1xuICBjYW5jZWxMYWJlbDogc3RyaW5nO1xuXG4gIG9rQnV0dG9uVGVtcGxhdGU6IFRlbXBsYXRlUmVmPE1hdFRpbWVwaWNrZXJCdXR0b25UZW1wbGF0ZUNvbnRleHQ+O1xuICBjYW5jZWxCdXR0b25UZW1wbGF0ZTogVGVtcGxhdGVSZWY8TWF0VGltZXBpY2tlckJ1dHRvblRlbXBsYXRlQ29udGV4dD47XG5cbiAgYW50ZU1lcmlkaWVtQWJicmV2aWF0aW9uOiBzdHJpbmc7XG4gIHBvc3RNZXJpZGllbUFiYnJldmlhdGlvbjogc3RyaW5nO1xuXG4gIHNldCB2YWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdmFsdWUgPSB2YWx1ZSB8fCB0aGlzLm1pbkRhdGUgfHwgdGhpcy5tYXhEYXRlIHx8IG5ldyBEYXRlKCk7XG4gICAgdGhpcy5ob3VycyA9IHZhbHVlLmdldEhvdXJzKCk7XG4gICAgdGhpcy5taW51dGVzID0gdmFsdWUuZ2V0TWludXRlcygpO1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gIH1cblxuICBnZXQgdmFsdWUoKSB7IHJldHVybiB0aGlzLl92YWx1ZTsgfVxuXG4gIG1vZGU6IENsb2NrTW9kZTtcbiAgdmlld1R5cGU6IENsb2NrVmlld1R5cGUgPSAnaG91cnMnO1xuXG4gIG1pbnV0ZXM6IGFueTtcbiAgY29sb3I6IHN0cmluZztcbiAgaXNQbSA9IGZhbHNlO1xuICBza2lwTWludXRlQXV0b1N3aXRjaCA9IGZhbHNlO1xuICBhdXRvU3dpdGNoSUQgPSBudWxsO1xuICBpbnZhbGlkTWVkaWFuSUQgPSBudWxsO1xuICBoYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgZWRpdEhvdXJzQ2xpY2tlZCA9IGZhbHNlO1xuICBpc0Nsb3NpbmcgPSBmYWxzZTtcblxuICBtaW5EYXRlOiBEYXRlO1xuICBtYXhEYXRlOiBEYXRlO1xuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG4gIF9mb3JtYXR0ZWRIb3VyOiBhbnk7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG4gIF9ob3VyczogYW55O1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxuICBfdmFsdWU6IERhdGU7XG5cbiAgc2V0IGhvdXJzKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLl9ob3VycyA9IHZhbHVlO1xuICAgIHRoaXMuX2Zvcm1hdHRlZEhvdXIgPSBjb252ZXJ0SG91cnNGb3JNb2RlKHRoaXMuaG91cnMsIHRoaXMubW9kZSkuaG91cjtcbiAgfVxuICBnZXQgaG91cnMoKSB7IHJldHVybiB0aGlzLl9ob3VyczsgfVxuXG4gIGdldCBmb3JtYXR0ZWRIb3VycygpIHsgcmV0dXJuIHRoaXMuX2Zvcm1hdHRlZEhvdXI7IH1cblxuICBiaW5kRGF0YShkYXRhOiBhbnkpIHtcbiAgICB0aGlzLm1vZGUgPSBkYXRhLm1vZGU7XG4gICAgdGhpcy5va0xhYmVsID0gZGF0YS5va0xhYmVsO1xuICAgIHRoaXMuY2FuY2VsTGFiZWwgPSBkYXRhLmNhbmNlbExhYmVsO1xuICAgIHRoaXMub2tCdXR0b25UZW1wbGF0ZSA9IGRhdGEub2tCdXR0b25UZW1wbGF0ZTtcbiAgICB0aGlzLmNhbmNlbEJ1dHRvblRlbXBsYXRlID0gZGF0YS5jYW5jZWxCdXR0b25UZW1wbGF0ZTtcbiAgICB0aGlzLmFudGVNZXJpZGllbUFiYnJldmlhdGlvbiA9IGRhdGEuYW50ZU1lcmlkaWVtQWJicmV2aWF0aW9uO1xuICAgIHRoaXMucG9zdE1lcmlkaWVtQWJicmV2aWF0aW9uID0gZGF0YS5wb3N0TWVyaWRpZW1BYmJyZXZpYXRpb247XG4gICAgdGhpcy5jb2xvciA9IGRhdGEuY29sb3I7XG4gICAgdGhpcy5taW5EYXRlID0gZGF0YS5taW5EYXRlO1xuICAgIHRoaXMubWF4RGF0ZSA9IGRhdGEubWF4RGF0ZTtcbiAgICB0aGlzLmFsbG93ZWQxMkhvdXJNYXAgPSBkYXRhLmFsbG93ZWQxMkhvdXJNYXA7XG4gICAgdGhpcy5hbGxvd2VkMjRIb3VyTWFwID0gZGF0YS5hbGxvd2VkMjRIb3VyTWFwO1xuICB9XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChNQVRfRElBTE9HX0RBVEEpIHB1YmxpYyBkYXRhKSB7XG4gICAgdGhpcy5pc1BtID0gZGF0YS5pc1BtO1xuICAgIHRoaXMuYmluZERhdGEoZGF0YSk7XG4gICAgLy8ga2VlcCB0aGlzIGFsd2F5cyBhdCB0aGUgYm90dG9tXG4gICAgdGhpcy52YWx1ZSA9IGRhdGEudmFsdWU7XG4gIH1cblxuICBuZ0RvQ2hlY2soKSB7IHRoaXMuYmluZERhdGEodGhpcy5kYXRhKTsgfVxuXG4gIGhhbmRsZUNsb2NrQ2hhbmdlKHsgdmFsdWUsIHR5cGUgfTogeyB2YWx1ZTogbnVtYmVyLCB0eXBlOiAnbWludXRlcycgfCAnaG91cnMnIH0pIHtcbiAgICBjb25zdCBpczI0aG91cnNBdXRvTWVyaWRpZW1DaGFuZ2UgPSB0aGlzLm1vZGUgPT09ICcyNGgnICYmIHR5cGUgPT09ICdob3VycycgJiYgKFxuICAgICAgKHRoaXMuaG91cnMgPj0gMTIgJiYgdmFsdWUgPCAxMikgfHwgKHRoaXMuaG91cnMgPCAxMiAmJiB2YWx1ZSA+PSAxMikpO1xuICAgIGlmICgodGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gJiYgdGhpcy5tb2RlID09PSAnMTJoJykgfHwgaXMyNGhvdXJzQXV0b01lcmlkaWVtQ2hhbmdlKSB7XG4gICAgICB0aGlzLmlzUG0gPSAhdGhpcy5pc1BtO1xuICAgICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoKHR5cGUgJiYgdHlwZSA9PT0gJ2hvdXJzJykgfHwgKCF0eXBlICYmIHRoaXMudmlld1R5cGUgPT09ICdob3VycycpKSB7XG4gICAgICB0aGlzLmhvdXJzID0gdmFsdWU7XG4gICAgfSBlbHNlIGlmICgodHlwZSAmJiB0eXBlID09PSAnbWludXRlcycpIHx8ICghdHlwZSAmJiB0aGlzLnZpZXdUeXBlID09PSAnbWludXRlcycpKSB7XG4gICAgICB0aGlzLm1pbnV0ZXMgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXdWYWx1ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgaG91cnMgPSB0aGlzLmlzUG0gPyB0aGlzLmhvdXJzIDwgMTIgPyB0aGlzLmhvdXJzICsgMTIgOiB0aGlzLmhvdXJzIDogdGhpcy5ob3VycyA9PT0gMTIgPyAwIDogdGhpcy5ob3VycztcbiAgICBuZXdWYWx1ZS5zZXRIb3Vycyhob3Vycyk7XG4gICAgbmV3VmFsdWUuc2V0TWludXRlcyh0aGlzLm1pbnV0ZXMpO1xuICAgIG5ld1ZhbHVlLnNldFNlY29uZHMoMCk7XG4gICAgbmV3VmFsdWUuc2V0TWlsbGlzZWNvbmRzKDApO1xuICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB0aGlzLmNoYW5nZUV2ZW50LmVtaXQobmV3VmFsdWUpO1xuICB9XG5cbiAgY2xlYXJJbnZhbGlkTWVyaWRpZW0oKSB7XG4gICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgfVxuXG4gIGhhbmRsZVVuYXZhaWxhYmxlU2VsZWN0aW9uKCkge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLmF1dG9Td2l0Y2hJRCk7XG4gIH1cblxuICBoYW5kbGVDbG9ja0NoYW5nZURvbmUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gcHJldmVudCBtb3VzZVVwIGFmdGVyIHRvdWNoRW5kXG5cbiAgICBpZiAodGhpcy52aWV3VHlwZSA9PT0gJ2hvdXJzJyAmJiAhdGhpcy5za2lwTWludXRlQXV0b1N3aXRjaCkge1xuICAgICAgdGhpcy5hdXRvU3dpdGNoSUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5lZGl0TWludXRlcygpO1xuICAgICAgICB0aGlzLmF1dG9Td2l0Y2hJRCA9IG51bGw7XG4gICAgICB9LCAzMDApO1xuICAgIH1cbiAgfVxuXG4gIGVkaXRIb3VycygpIHtcbiAgICB0aGlzLnZpZXdUeXBlID0gJ2hvdXJzJztcbiAgICB0aGlzLmVkaXRIb3Vyc0NsaWNrZWQgPSB0cnVlO1xuICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLmVkaXRIb3Vyc0NsaWNrZWQgPSBmYWxzZTsgfSwgMCk7XG4gIH1cblxuICBlZGl0TWludXRlcygpIHtcbiAgICBpZiAodGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0pIHtcbiAgICAgIHRoaXMuaXNQbSA9ICF0aGlzLmlzUG07XG4gICAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLnZpZXdUeXBlID0gJ21pbnV0ZXMnO1xuICB9XG5cbiAgaW52YWxpZFNlbGVjdGlvbkhhbmRsZXIodmFsdWUpIHtcbiAgICB0aGlzLmludmFsaWRTZWxlY3Rpb24gPSB2YWx1ZTtcbiAgfVxuXG5cbiAgaW52YWxpZE1lcmlkaWVtKCkge1xuICAgIGlmICh0aGlzLnZpZXdUeXBlICE9PSAnbWludXRlcycgJiYgdGhpcy5lZGl0SG91cnNDbGlja2VkKSB7XG4gICAgICBpZiAodGhpcy5pbnZhbGlkTWVkaWFuSUQpIHsgcmV0dXJuOyB9XG4gICAgICB0aGlzLmludmFsaWRNZWRpYW5JRCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmlzUG0gPSAhdGhpcy5pc1BtO1xuICAgICAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICAgICAgfSwgMCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtID0gdHJ1ZTtcbiAgfVxuXG4gIG1lcmlkaWVtQ2hhbmdlKGhvdXJzKSB7XG4gICAgY29uc3QgY2hhbmdlRGF0YSA9IHtcbiAgICAgIHR5cGU6IHRoaXMudmlld1R5cGUsXG4gICAgICB2YWx1ZTogdGhpcy52aWV3VHlwZSA9PT0gJ2hvdXJzJyA/IGhvdXJzIDogdGhpcy52YWx1ZS5nZXRNaW51dGVzKClcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlQ2xvY2tDaGFuZ2UoY2hhbmdlRGF0YSk7XG4gIH1cblxuXG4gIHNldEFtKCkge1xuICAgIGlmICh0aGlzLmhvdXJzID49IDEyKSB7XG4gICAgICB0aGlzLmhvdXJzID0gdGhpcy5ob3VycyAtIDEyO1xuICAgIH1cbiAgICB0aGlzLmlzUG0gPSBmYWxzZTtcblxuICAgIHRoaXMubWVyaWRpZW1DaGFuZ2UodGhpcy5ob3Vycyk7XG4gIH1cblxuICBzZXRQbSgpIHtcbiAgICBpZiAodGhpcy5ob3VycyA8IDEyKSB7XG4gICAgICB0aGlzLmhvdXJzID0gdGhpcy5ob3VycyArIDEyO1xuICAgIH1cbiAgICB0aGlzLmlzUG0gPSB0cnVlO1xuICAgIHRoaXMubWVyaWRpZW1DaGFuZ2UodGhpcy5ob3Vycyk7XG4gIH1cblxuICBva0NsaWNrSGFuZGxlciA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0pIHtcbiAgICAgIHRoaXMuaXNQbSA9ICF0aGlzLmlzUG07XG4gICAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLm9rQ2xpY2tFdmVudC5lbWl0KHRoaXMudmFsdWUpO1xuICB9XG5cbiAgY2FuY2VsQ2xpY2tIYW5kbGVyID0gKCkgPT4ge1xuICAgIHRoaXMuY2FuY2VsQ2xpY2tFdmVudC5lbWl0KCk7XG4gIH1cblxufVxuIiwiPG5nLXRlbXBsYXRlICNkZWZhdWx0Q2FuY2VsQnV0dG9uVGVtcGxhdGU+XG4gIDxidXR0b24gbWF0LWJ1dHRvbiBbY29sb3JdPVwiY29sb3JcIiAoY2xpY2spPVwiY2FuY2VsQ2xpY2tIYW5kbGVyKClcIj57e2NhbmNlbExhYmVsfX08L2J1dHRvbj5cbjwvbmctdGVtcGxhdGU+XG48bmctdGVtcGxhdGUgI2RlZmF1bHRPa0J1dHRvblRlbXBsYXRlPlxuICA8YnV0dG9uIG1hdC1idXR0b24gW2Rpc2FibGVkXT1cImludmFsaWRTZWxlY3Rpb25cIiBbY29sb3JdPVwiY29sb3JcIiAoY2xpY2spPVwib2tDbGlja0hhbmRsZXIoKVwiPnt7b2tMYWJlbH19PC9idXR0b24+XG48L25nLXRlbXBsYXRlPlxuXG48bWF0LWRpYWxvZy1jb250ZW50PlxuICA8ZGl2IGNsYXNzPVwicm9vdFwiPlxuICAgIDxtYXQtdG9vbGJhciBbY29sb3JdPVwiY29sb3JcIiBjbGFzcz1cImhlYWRlclwiPlxuICAgICAgPGRpdiBjbGFzcz1cInBsYWNlaG9sZGVyXCI+PC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwidGltZS1mcmFtZVwiPlxuICAgICAgICA8c3BhbiBjbGFzcz1cInRpbWUgZml4ZWQtZm9udC1zaXplXCIgW25nQ2xhc3NdPVwieydzZWxlY3QnOiB0aGlzLnZpZXdUeXBlID09PSAnaG91cnMnICYmICdhY3RpdmUnIH1cIlxuICAgICAgICAgIChjbGljayk9XCJlZGl0SG91cnMoKVwiPlxuICAgICAgICAgIHt7IHR3b0RpZ2l0cyhmb3JtYXR0ZWRIb3VycykgfX1cbiAgICAgICAgPC9zcGFuPlxuICAgICAgICA8c3BhbiBjbGFzcz1cImZpeGVkLWZvbnQtc2l6ZVwiPjo8L3NwYW4+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwidGltZSBmaXhlZC1mb250LXNpemVcIiBbbmdDbGFzc109XCJ7ICdzZWxlY3QnOiB0aGlzLnZpZXdUeXBlID09PSAnbWludXRlcycgJiYgJ2FjdGl2ZScgfVwiXG4gICAgICAgICAgKGNsaWNrKT1cImVkaXRNaW51dGVzKClcIj5cbiAgICAgICAgICB7eyB0d29EaWdpdHMobWludXRlcykgfX1cbiAgICAgICAgPC9zcGFuPlxuICAgICAgPC9kaXY+XG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwibW9kZSA9PT0gJzEyaCcgdGhlbiBhbXBtIGVsc2Ugbm9ybWFsXCI+PC9uZy1jb250YWluZXI+XG4gICAgICA8bmctdGVtcGxhdGUgI25vcm1hbD5cbiAgICAgICAgPGRpdiBjbGFzcz1cInBsYWNlaG9sZGVyXCI+PC9kaXY+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgPG5nLXRlbXBsYXRlICNhbXBtPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYW1wbVwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGltZVwiIFtuZ0NsYXNzXT1cInsgJ3NlbGVjdCc6IGlzUG0gfVwiIChjbGljayk9XCJzZXRQbSgpXCI+e3twb3N0TWVyaWRpZW1BYmJyZXZpYXRpb24gfCB1cHBlcmNhc2VcbiAgICAgICAgICAgIH19PC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwidGltZVwiIFtuZ0NsYXNzXT1cInsgJ3NlbGVjdCc6ICFpc1BtIH1cIiAoY2xpY2spPVwic2V0QW0oKVwiPnt7YW50ZU1lcmlkaWVtQWJicmV2aWF0aW9uIHwgdXBwZXJjYXNlXG4gICAgICAgICAgICB9fTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgIDwvbWF0LXRvb2xiYXI+XG4gICAgPGRpdiBjbGFzcz1cImJvZHlcIj5cbiAgICAgIDxtYXQtY2xvY2sgW2FsbG93ZWQxMkhvdXJNYXBdPVwiYWxsb3dlZDEySG91ck1hcFwiIFthbGxvd2VkMjRIb3VyTWFwXT1cImFsbG93ZWQyNEhvdXJNYXBcIiBbbWluRGF0ZV09XCJtaW5EYXRlXCJcbiAgICAgICAgW21heERhdGVdPVwibWF4RGF0ZVwiIFtjb2xvcl09XCJjb2xvclwiIFt2aWV3VHlwZV09XCJ2aWV3VHlwZVwiIFttb2RlXT1cIm1vZGVcIiBbZm9ybWF0dGVkSG91cnNdPVwiZm9ybWF0dGVkSG91cnNcIlxuICAgICAgICBbbWludXRlc109XCJtaW51dGVzXCIgKGNoYW5nZUV2ZW50KT1cImhhbmRsZUNsb2NrQ2hhbmdlKCRldmVudClcIlxuICAgICAgICAodW5hdmFpbGFibGVTZWxlY3Rpb24pPVwiaGFuZGxlVW5hdmFpbGFibGVTZWxlY3Rpb24oKVwiXG4gICAgICAgIFtmb3JtYXR0ZWRWYWx1ZV09XCJ2aWV3VHlwZSA9PT0gJ21pbnV0ZXMnID8gbWludXRlcyA6IGZvcm1hdHRlZEhvdXJzXCIgW2lzUG1dPVwiaXNQbVwiXG4gICAgICAgIChpbnZhbGlkTWVyaWRpZW0pPVwiaW52YWxpZE1lcmlkaWVtKClcIiAobW91c2V1cCk9XCJoYW5kbGVDbG9ja0NoYW5nZURvbmUoJGV2ZW50KVwiXG4gICAgICAgIChjbGVhckludmFsaWRNZXJpZGllbSk9XCJjbGVhckludmFsaWRNZXJpZGllbSgpXCIgKHRvdWNoZW5kKT1cImhhbmRsZUNsb2NrQ2hhbmdlRG9uZSgkZXZlbnQpXCJcbiAgICAgICAgKGludmFsaWRTZWxlY3Rpb24pPVwiaW52YWxpZFNlbGVjdGlvbkhhbmRsZXIoJGV2ZW50KVwiPjwvbWF0LWNsb2NrPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbWF0LWRpYWxvZy1jb250ZW50PlxuPG1hdC1kaWFsb2ctYWN0aW9ucz5cbiAgPG5nLWNvbnRhaW5lclxuICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwiY2FuY2VsQnV0dG9uVGVtcGxhdGUgfHwgZGVmYXVsdENhbmNlbEJ1dHRvblRlbXBsYXRlOyBjb250ZXh0OiB7IGxhYmVsOiBjYW5jZWxMYWJlbCwgJGltcGxpY2l0OiBjYW5jZWxDbGlja0hhbmRsZXIgfVwiPlxuICA8L25nLWNvbnRhaW5lcj5cbiAgPG5nLWNvbnRhaW5lclxuICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwib2tCdXR0b25UZW1wbGF0ZSB8fCBkZWZhdWx0T2tCdXR0b25UZW1wbGF0ZTsgY29udGV4dDogeyBsYWJlbDogb2tMYWJlbCwgJGltcGxpY2l0OiBva0NsaWNrSGFuZGxlciB9XCI+XG4gIDwvbmctY29udGFpbmVyPlxuPC9tYXQtZGlhbG9nLWFjdGlvbnM+Il19